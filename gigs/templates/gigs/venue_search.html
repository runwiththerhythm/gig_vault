<!-- Mapbox venue_search.html -->

<div id="{{ element_id }}" class="mb-3"></div>

<!-- Hidden input to store selected venue name -->
<input type="hidden" id="{{ input_id }}" name="{{ input_name }}" value="{{ initial_value|default:'' }}">

<script>
  document.addEventListener('DOMContentLoaded', function () {
    mapboxgl.accessToken = '{{ mapbox_token }}';

    const geocoder = new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      mapboxgl: mapboxgl,
      placeholder: '{{ placeholder|default:"Search for venue" }}',
      marker: false,
      limit: 5,
    });

    const container = document.getElementById('{{ element_id }}');
    container.appendChild(geocoder.onAdd());

    const hiddenInput = document.getElementById('{{ input_id }}');

    geocoder.on('result', function (e) {
      hiddenInput.value = e.result.text;  // or use e.result.place_name for full
    });

    // Optionally clear hidden input on clear event
    geocoder.on('clear', function () {
      hiddenInput.value = '';
    });
  });
</script>